<!doctype html>
<html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><base href="../"/><link href="css/built.css?1508703112945" rel="stylesheet"/><title>Reagent: Cloact becomes Reagent: Undo is trivial</title></head><body><div id="main-content"><div><div data-reactroot=""><div class="nav"><ul class="nav"><li class="brand"><a href="index.html">Reagent:</a></li><li><a href="index.html">Intro</a></li><li><a href="news/index.html">News</a></li><li><a href="https://github.com/reagent-project/reagent">GitHub</a></li><li><a href="http://reagent-project.github.io/docs/master/">API</a></li></ul></div><div></div><div class="reagent-demo"><h1><a href="news/cloact-reagent-undo-demo.html">Cloact becomes Reagent: Undo is trivial</a></h1><div class="demo-text"><h2>(reset! cloact-name &quot;Reagent&quot;)</h2><p>It turns out that ”Cloact” was a really, really bad
      name. It made some people think about birds’ behinds, in
      possibly unhealthy ways, which even Google suggested they
      should.</p><p>The new name is <strong>Reagent</strong>, which hopefully
      doesn’t bring with it the same disgusting connotations.</p><p>The API is otherwise unchanged, so a simple
      search-and-replace should suffice.</p><div class="demo-text"><h2>Undo the easy way</h2><p>To celebrate the undoing of the apparently disgusting
         name, here is an example of how easy it is to add undo
         functionality to Reagent components.</p><p>It simply saves the old state whenever it changes, and
         restores it when the button is clicked.</p><p>The really nice thing about ClojureScript is that not
         only is this easy and safe to do, courtesy of immutable data
         structures, it is also efficient. ClojureScript figures out
         how to represent ”changes” to maps and vectors efficiently,
         so that you won’t have to.</p><div><div class="demo-example clearfix"><a class="demo-example-hide">hide</a><h3 class="demo-heading">Example </h3><div class="simple-demo"><div><input type="button" disabled="" value="Undo (0)"/><div><section id="todoapp"><header id="header"><h1>todos</h1><input type="text" id="new-todo" placeholder="What needs to be done?" value=""/></header><div><section id="main"><input type="checkbox" checked="" id="toggle-all"/><label for="toggle-all">Mark all as complete</label><ul id="todo-list"><li class="completed "><div class="view"><input type="checkbox" checked="" class="toggle"/><label>Rename Cloact to Reagent</label><button class="destroy"></button></div></li><li class="completed "><div class="view"><input type="checkbox" checked="" class="toggle"/><label>Add undo demo</label><button class="destroy"></button></div></li><li class="completed "><div class="view"><input type="checkbox" checked="" class="toggle"/><label>Make all rendering async</label><button class="destroy"></button></div></li><li class="completed "><div class="view"><input type="checkbox" checked="" class="toggle"/><label>Allow any arguments to component functions</label><button class="destroy"></button></div></li></ul></section><footer id="footer"><div><span id="todo-count"><strong>0</strong> <!-- -->items<!-- --> left</span><ul id="filters"><li><a class="selected">All</a></li><li><a>Active</a></li><li><a>Completed</a></li></ul><button id="clear-completed">Clear completed <!-- -->4</button></div></footer></div></section><footer id="info"><p>Double-click to edit a todo</p></footer></div></div></div></div><div class="demo-source clearfix"><h3 class="demo-heading">Source</h3><pre><pre><span style="color:#272">(</span><span style="color:#687868;font-weight:bold">ns</span> <span style="color:#5050c0;font-weight:bold">example</span>
  <span style="color:#940">(</span><span style="color:blue">:require</span> <span style="color:#44a">[</span>reagent.core <span style="color:blue">:as</span> r<span style="color:#44a">]</span><span style="color:#940">)</span><span style="color:#272">)</span></pre><pre><span style="color:#272">(</span><span style="color:#687868;font-weight:bold">def</span> <span style="color:#5050c0;font-weight:bold">state</span> <span style="color:#687868;font-weight:bold">todomvc/todos</span><span style="color:#272">)</span>

<span style="color:#272">(</span><span style="color:#687868;font-weight:bold">def</span> <span style="color:#5050c0;font-weight:bold">undo-list</span> <span style="color:#940">(</span><span style="color:#687868;font-weight:bold">r/atom</span> nil<span style="color:#940">)</span><span style="color:#272">)</span>

<span style="color:#272">(</span><span style="color:#687868;font-weight:bold">defn</span> <span style="color:#5050c0;font-weight:bold">undo</span> <span style="color:#940">[</span><span style="color:#940">]</span>
  <span style="color:#940">(</span><span style="color:#687868;font-weight:bold">let</span> <span style="color:#44a">[</span>undos @undo-list<span style="color:#44a">]</span>
    <span style="color:#44a">(</span><span style="color:#687868;font-weight:bold">when-let</span> <span style="color:#272">[</span>old <span style="color:#940">(</span><span style="color:#687868;font-weight:bold">first</span> undos<span style="color:#940">)</span><span style="color:#272">]</span>
      <span style="color:#272">(</span><span style="color:#687868;font-weight:bold">reset!</span> state old<span style="color:#272">)</span>
      <span style="color:#272">(</span><span style="color:#687868;font-weight:bold">reset!</span> undo-list <span style="color:#940">(</span><span style="color:#687868;font-weight:bold">rest</span> undos<span style="color:#940">)</span><span style="color:#272">)</span><span style="color:#44a">)</span><span style="color:#940">)</span><span style="color:#272">)</span>


<span style="color:#272">(</span><span style="color:#687868;font-weight:bold">defn</span> <span style="color:#5050c0;font-weight:bold">undo-button</span> <span style="color:#940">[</span><span style="color:#940">]</span>
  <span style="color:#940">(</span><span style="color:#687868;font-weight:bold">let</span> <span style="color:#44a">[</span>n <span style="color:#272">(</span><span style="color:#687868;font-weight:bold">count</span> @undo-list<span style="color:#272">)</span><span style="color:#44a">]</span>
    <span style="color:#44a">[</span><span style="color:blue">:input</span> <span style="color:#272">{</span><span style="color:blue">:type</span> <span style="color:green">&quot;button&quot;</span> <span style="color:blue">:on-click</span> undo
             <span style="color:blue">:disabled</span> <span style="color:#940">(</span><span style="color:#687868;font-weight:bold">zero?</span> n<span style="color:#940">)</span>
             <span style="color:blue">:value</span> <span style="color:#940">(</span><span style="color:#687868;font-weight:bold">str</span> <span style="color:green">&quot;Undo (&quot;</span> n <span style="color:green">&quot;)&quot;</span><span style="color:#940">)</span><span style="color:#272">}</span><span style="color:#44a">]</span><span style="color:#940">)</span><span style="color:#272">)</span>

<span style="color:#272">(</span><span style="color:#687868;font-weight:bold">defn</span> <span style="color:#5050c0;font-weight:bold">todomvc-with-undo</span> <span style="color:#940">[</span><span style="color:#940">]</span>
  <span style="color:#940">(</span><span style="color:#687868;font-weight:bold">add-watch</span> state <span style="color:blue">::undo-watcher</span>
             <span style="color:#44a">(</span><span style="color:#687868;font-weight:bold">fn</span> <span style="color:#272">[</span>_ _ old-state _<span style="color:#272">]</span>
               <span style="color:#272">(</span><span style="color:#687868;font-weight:bold">swap!</span> undo-list <span style="color:#687868;font-weight:bold">conj</span> old-state<span style="color:#272">)</span><span style="color:#44a">)</span><span style="color:#940">)</span>
  <span style="color:#940">[</span><span style="color:blue">:div</span>
   <span style="color:#44a">[</span>undo-button<span style="color:#44a">]</span>
   <span style="color:#44a">[</span><span style="color:#687868;font-weight:bold">todomvc/todo-app</span><span style="color:#44a">]</span><span style="color:#940">]</span><span style="color:#272">)</span></pre></pre></div></div></div></div></div><a href="https://github.com/reagent-project/reagent" class="github-badge"><img style="position:absolute;top:0;left:0;border:0" alt="Fork me on GitHub" src="https://s3.amazonaws.com/github/ribbons/forkme_left_orange_ff7600.png"/></a></div></div></div><script>var pageConfig = {"page-path":"/news/cloact-reagent-undo-demo.html"}</script><script src="js/main.js?1508703112945" type="text/javascript"></script></body></html>